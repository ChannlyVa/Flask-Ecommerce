{% extends "front/layouts/master.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="container w-100 mt-3 mb-5 p-0">
    <h2 class="text-center mb-4">Checkout</h2>

    <form action="/order" method="POST" @submit.prevent="submitOrder">
        <div class="row g-4 bg-white p-4 border rounded">
            <!-- Left Column: Customer Info & Payment -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <strong>Order Summary</strong>
                    </div>
                    <div class="card-body">
                        <ul class="list-group mb-3">
                            <li v-for="(item, index) in cart_list" :key="index"
                                class="list-group-item d-flex justify-content-between align-items-center">
                                <span class="">[item.title.substring(0, 20)]... (x[item.qty])</span>
                                <strong>[(item.price * item.qty).toFixed(2)] $</strong>
                            </li>
                        </ul>
                        <h5 class=" float-end font-bold">Total: $[grandTotal.toFixed(2)]</h5>
                    </div>
                </div>
            </div>

            <!-- Right Column: Order Summary -->
            <div class="col-md-6">
                <!-- Customer Info -->
                <div class="card p-3 mb-4">
                    <h5 class="mb-3">Customer Information</h5>
                    <form action="/order" method="post">
                        <div class="row g-3 mb-3">
                            <div class="col-12">
                                <label for="fullname" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="fullname" name="fullname" required>
                            </div>
                            <div class="col-12">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>
                            <div class="col-12">
                                <label for="phone" class=" form-label">Phone Number</label>
                                <input type="number" name="phone" id="phone" class=" form-control" required>
                            </div>
                            <div class="col-12">
                                <label for="address" class="form-label">Shipping Address</label>
                                <textarea name="address" id="address" class="form-control" rows="5" required></textarea>
                            </div>
                            <div class="col-12">
                                <input type="hidden" name="cart_item" id="cart_item" v-model="cartListJson">
                            </div>
                        </div>
                        <!-- Submit Button -->
                        <div class=" d-flex justify-content-end aligh-item-center gap-3">
                            <a href="/cart" class="btn btn-sm btn-secondary">Back</a>
                            <button type="submit" class="btn btn-sm btn-primary">Place Order</button>
                        </div>
                    </form>

                </div>
            </div>

        </div>
    </form>
</div>
{% endblock %}

{% block customScript %}
<script>


    const {createApp} = Vue;

    createApp({
        delimiters: ['[', ']'],
        data() {
            return {
                cart_list: JSON.parse(localStorage.getItem("cart_list") || "[]"),
            };
        },
        computed: {
            grandTotal() {
                return this.cart_list.reduce((sum, product) => sum + (product.price * product.qty), 0);
            },
            cartListJson() {
                return JSON.stringify(this.cart_list);
            }
        },
        methods: {
            submitOrder(event) {
                if (this.cart_list.length === 0) {
                    Swal.fire('Cart is empty', 'Please add at least one product before ordering.', 'warning');
                } else {
                    event.target.submit(); // proceed with form submission
                }
            }
        }
    }).mount('#app');
</script>
{% endblock %}