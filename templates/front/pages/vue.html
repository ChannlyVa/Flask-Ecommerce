{% extends "front/layouts/master.html" %}

{% block title %}Vue{% endblock %}

{% block content %}
<div id="app" class="container h-100 w-100 mt-3 mb-5 p-0">
    <h2 class="text-center mb-4">Vue List</h2>
    <div class="container-fluid border rounded p-4 mb-4">
        <form action="" @submit.prevent>
            <div class=" form-group mb-3">
                <label for="name" class=" form-label">Name</label>
                <input type="text" v-model="name" name="name" class=" shadow-none form-control">
            </div>
            <div class=" form-group mb-3">
                <label for="gender" class=" form-label">Gender</label>
                <select class=" form-select shadow-none" v-model="gender" name="gender" id="gender">
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>
            </div>
            <div class=" form-group mb-3">
                <label for="age" class=" form-label">Age</label>
                <input type="number" v-model="age" name="age" class=" shadow-none form-control">
            </div>
            <div class="form-group d-flex justify-content-end gap-3 mb-3">
                <button @click="save()" class=" btn btn-sm btn-primary">[ editIndex === null ? 'Save' : 'Update'
                    ]</button>
                <button @click="clear()" class=" btn btn-sm btn-danger">Clear</button>
            </div>
        </form>
    </div>
    <div class="container border rounded p-4">
        <table class="table table-responsive table-hover">
            <thead class="table-dark align-middle">
                <tr>
                    <td>No</td>
                    <td>Name</td>
                    <td>Gender</td>
                    <td>Age</td>
                    <td>Actions</td>
                </tr>
            </thead>
            <tbody class="align-middle">
                <tr v-for="(user, index) in user_list" :key="index">
                    <td>[ index + 1 ]</td>
                    <td>[ user.name ]</td>
                    <td>[ user.gender ]</td>
                    <td>[ user.age ]</td>
                    <td class="d-flex justify-content-start align-items-center gap-3">
                        <button class="btn btn-sm btn-primary" @click="edit(index)">Edit</button>
                        <button class="btn btn-sm btn-danger" @click="remove(index)">Delete</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>


</div>
{% endblock %}

{% block customScript %}
<script>
    const { createApp } = Vue;

    createApp({
        delimiters: ['[', ']'],
        data() {
            return {
                name: null,
                gender: 'male',
                age: null,
                user_list: JSON.parse(localStorage.getItem("user_list") || "[]"),
                editIndex: null,
                message: ''
            };
        },
        methods: {
            save() {
                if (!this.name || !this.age) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Missing Info',
                        text: 'Name and Age are required.'
                    });
                    return;
                }

                const user = {
                    name: this.name,
                    gender: this.gender,
                    age: this.age
                };

                if (this.editIndex === null) {
                    // Add new user
                    this.user_list.push(user);
                    Swal.fire('Created!', 'User has been created.', 'success');
                } else {
                    // Update existing user
                    this.user_list[this.editIndex] = user;
                    Swal.fire('Updated!', 'User has been updated.', 'success');
                }

                this.updateStorage();
                this.clear();
            },


            clear() {
                this.name = null;
                this.gender = 'male';
                this.age = null;
                this.editIndex = null;
            },
            edit(index) {
                const user = this.user_list[index];
                this.name = user.name;
                this.gender = user.gender;
                this.age = user.age;
                this.editIndex = index;
            },
            remove(index) {
                Swal.fire({
                    title: 'Are you sure?',
                    text: 'This user will be deleted.',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        this.user_list.splice(index, 1);
                        this.updateStorage();
                        this.clear();
                        Swal.fire('Deleted!', 'User has been removed.', 'success');
                    }
                });
            },
            updateStorage() {
                localStorage.setItem('user_list', JSON.stringify(this.user_list));
            }
        }
    }).mount('#app');
</script>

{% endblock %}